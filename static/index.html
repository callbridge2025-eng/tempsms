<!doctype html>


<p>Incoming SMS to your Twilio numbers will appear below. Messages are stored in memory only; restarting the app clears them.</p>


<div id="messages"></div>


<script>
const messagesEl = document.getElementById('messages');
const statusEl = document.getElementById('status');
const refreshBtn = document.getElementById('refresh');


async function load(){
try{
statusEl.textContent = 'Loading...';
const res = await fetch('/messages?t=' + Date.now(), { cache: 'no-store' });
if(!res.ok) throw new Error('HTTP ' + res.status);
const data = await res.json();
statusEl.textContent = data.length + ' messages';
render(data);
}catch(err){
statusEl.textContent = 'Error: ' + err.message;
console.error(err);
}
}


function render(list){
messagesEl.innerHTML = '';


const raw = document.createElement('pre');
raw.style.fontSize = '12px';
raw.style.background = '#f7f7f7';
raw.style.padding = '6px';
raw.style.borderRadius = '6px';
raw.textContent = JSON.stringify(list, null, 2);
messagesEl.appendChild(raw);


if(list.length === 0){
messagesEl.innerHTML += '<p><em>No messages yet.</em></p>';
return;
}


list.forEach(m => {
const div = document.createElement('div');
div.className = 'msg';
div.innerHTML = `
<div class="meta"><strong>From:</strong> ${escapeHtml(m.from || '')} &nbsp; <strong>To:</strong> ${escapeHtml(m.to || '')} &nbsp; <strong>At:</strong> ${escapeHtml(m.received_at || '')}</div>
<div>${escapeHtml(m.body || '')}</div>
<div style="margin-top:8px;font-size:12px;color:#888"><strong>SID:</strong> ${escapeHtml(m.message_sid || '')} â€” <strong>Media:</strong> ${m.num_media}</div>
`;
messagesEl.appendChild(div);
});
}


function escapeHtml(s){
return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]));
}


refreshBtn.addEventListener('click', load);


load();
setInterval(load, 5000);
</script>
</body>
</html>
